import { HttpMethod } from '../../http/HttpRequest';
/**
 * Base class for all Resources
 */
export class HalResource {
    /**
     * Creates a new instance of the resource.
     * If data is provided it will be parsed as if it had
     * come from the remote api.
     * @param data
     */
    constructor(data) {
        if (data) {
            this.parse(data);
        }
    }
    /**
     * Parses the data returned by the API into the model class
     * @hidden
     */
    parse(data) {
        Object.assign(this, data);
    }
    /**
     * Returns a copy of this resource's attributes excluding links and client references
     */
    toJSON() {
        const result = Object.assign({}, this);
        delete result.client;
        delete result._links;
        delete result.related;
        return result;
    }
    /**
     * Returns a copy of this resource's attributes excluding links and client references
     * @deprecated
     */
    toJson() {
        return this.toJSON();
    }
    /**
     * Set automatically by the HalClient when the resource is created.
     * If this is not set the resource will be unable to resolve related
     * resources and actions.
     *
     * @hidden
     */
    setClient(client) {
        this.client = client;
    }
    /**
     * Converts an _embedded collection into an Array of
     * Resource instances.
     * @hidden
     */
    parseEmbedded(name, resourceConstructor) {
        if (this._embedded[name]) {
            return this._embedded[name].map((x) => this.client.parse(x, resourceConstructor));
        }
        else {
            return [];
        }
    }
    /**
     * GET a linked resource
     * @hidden
     */
    fetchLinkedResource(name, params, resourceConstructor) {
        return this.withHalLink(name).then(([link, client]) => client.fetchLinkedResource(link, params, resourceConstructor));
    }
    /**
     * POST / CREATE a new resource
     * @hidden
     */
    createLinkedResource(name, params, resource, resourceConstructor) {
        return this.withHalLink(name).then(([link, client]) => client.createLinkedResource(link, params, resource, resourceConstructor));
    }
    /**
     * POST to an action endpoint and get a resource response
     * @hidden
     */
    performActionThatReturnsResource(name, params, data, resourceConstructor, method = HttpMethod.POST) {
        return this.withHalLink(name).then(([link, client]) => client.performActionThatReturnsResource(link, params, data, resourceConstructor, method));
    }
    /**
     * POST to an action endpoint with no resource response returned.
     */
    performActionWithoutResourceResponse(name) {
        return this.withHalLink(name).then(([link, client]) => client.performActionWithoutResourceResponse(link));
    }
    /**
     * DELETE the current resource
     * @hidden
     */
    deleteResource() {
        return this.deleteLinkedResource('delete', {});
    }
    /**
     * DELETE a linked resource
     * @hidden
     */
    deleteLinkedResource(name, params) {
        return this.withHalLink(name).then(([link, client]) => client.deleteLinkedResource(link, params));
    }
    /**
     * PATCH the current resource
     * @hidden
     */
    updateResource(resource, resourceConstructor) {
        return this.updateLinkedResource('update', {}, resource, resourceConstructor);
    }
    /**
     * PATCH a linked resource
     * @hidden
     */
    updateLinkedResource(name, params, resource, resourceConstructor) {
        return this.withHalLink(name).then(([link, client]) => client.updateLinkedResource(link, params, resource, resourceConstructor));
    }
    withHalLink(name) {
        if (!this.client) {
            return Promise.reject(new Error('HalResource has no client'));
        }
        const link = this._links[name];
        if (!link) {
            return Promise.reject(`The ${name} action is not available, ensure you have permission to perform this action.`);
        }
        return Promise.resolve([link, this.client]);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSGFsUmVzb3VyY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2hhbC9tb2RlbHMvSGFsUmVzb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBV3BEOztHQUVHO0FBQ0gsTUFBTSxPQUFPLFdBQVc7SUFldEI7Ozs7O09BS0c7SUFDSCxZQUFZLElBQVU7UUFDcEIsSUFBSSxJQUFJLEVBQUU7WUFDUixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2xCO0lBQ0gsQ0FBQztJQUVEOzs7T0FHRztJQUNJLEtBQUssQ0FBQyxJQUFTO1FBQ3BCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRDs7T0FFRztJQUNJLE1BQU07UUFDWCxNQUFNLE1BQU0sR0FBUSxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM1QyxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDckIsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDO1FBQ3JCLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQztRQUN0QixPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksTUFBTTtRQUNYLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSSxTQUFTLENBQUMsTUFBaUI7UUFDaEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDdkIsQ0FBQztJQUVEOzs7O09BSUc7SUFDTyxhQUFhLENBQ3JCLElBQVksRUFDWixtQkFBOEM7UUFFOUMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3hCLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJ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